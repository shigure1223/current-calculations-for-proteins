
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.4. Heat current analysis &#8212; CURP 1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="4. Reference" href="../reference/" />
    <link rel="prev" title="3.3. Energy flow analysis" href="../eflow_tutorial/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../reference/" title="4. Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../eflow_tutorial/" title="3.3. Energy flow analysis"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">CURP 1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorials/" accesskey="U"><span class="section-number">3. </span>Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.4. </span>Heat current analysis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="heat-current-analysis">
<h1><span class="section-number">3.4. </span>Heat current analysis<a class="headerlink" href="#heat-current-analysis" title="Permalink to this headline">¶</a></h1>
<p><strong>Local heat current</strong></p>
<p>The thermal conductivity, <span class="math notranslate nohighlight">\(\lambda\)</span>, is expressed in terms of the heat current autocorrelation function (HCACF) as:</p>
<div class="math notranslate nohighlight">
\[\lambda = \frac{1}{3Vk_BT^2} \int_0^\infty \left\langle \mathbf{h}_(0) \cdot \mathbf{h}(t) \right\rangle dt.\]</div>
<p>The heat current, <span class="math notranslate nohighlight">\(\mathbf{h}\)</span>, is written as a summation of interatomic heat current, <span class="math notranslate nohighlight">\(\mathbf{h}_{ij}\)</span>, as:</p>
<div class="math notranslate nohighlight">
\[\mathbf{h} = \sum_i \sum_{j&gt;i}(\mathbf{r}_i - \mathbf{r}_j)J_{i \leftarrow j} = \sum_i \sum_{j&gt;i} \mathbf{h}_{ij}\]</div>
<p>The heat current between atom groups, A and B, can be calculated by the summation of local heat current between the pair:</p>
<div class="math notranslate nohighlight">
\[\mathbf{h}_{AB} =
   \sum_{i \in A} \sum_{j \in B} \mathbf{h}_{ij}.\]</div>
<p>If the atom groups A and B represent residues A and B, respectively, the contribution of this local heat current between the residue pair to the overall thermal conductivity is expressed as:</p>
<div class="math notranslate nohighlight">
\[\Lambda_{AB} = \int_0^\infty  {\left\langle
   {\mathbf{h}_{AB}}(t) \cdot {\mathbf{h}_{AB}}(0)
\right\rangle dt}.\]</div>
<p>This calculation is performed by the numerical integration of the auto-correlation function of <span class="math notranslate nohighlight">\(\mathbf{h}\)</span> using trapezoidal rule.  The CURP program performs these calculations for the proteins and visualizes the energy conductivities using an energy exchange network (EEN). This allows the user to grasp the pattern of the inter-residue interactions at a glance. In principle, it is possible to calculate <span class="math notranslate nohighlight">\(\Lambda\)</span> based on a single NVE trajectory. However, it is highly recommended to calulate thermal averages of <span class="math notranslate nohighlight">\(\Lambda\)</span> based on multiple NVE trajectories that start from different points on the energy landscape of the target protein. If the number of the NVE trajectories are sufficiently large, the thermally averaged <span class="math notranslate nohighlight">\(\Lambda\)</span> are fair representations of the <span class="math notranslate nohighlight">\(\Lambda\)</span> of the thermally fluctuating protein system.</p>
<p>CURP analyzes the inter-residue interactions through the following steps:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#preparing-trajectories" id="id1">Preparing trajectories</a></p></li>
<li><p><a class="reference internal" href="#calculating-interresidue-heat-current" id="id2">Calculating interresidue heat current</a></p></li>
<li><p><a class="reference internal" href="#calculating-the-time-integral-of-interresidue-heat-current" id="id3">Calculating the time-integral of interresidue heat current</a></p></li>
</ul>
</div>
<section id="preparing-trajectories">
<h2><a class="toc-backref" href="#id1"><span class="section-number">3.4.1. </span>Preparing trajectories</a><a class="headerlink" href="#preparing-trajectories" title="Permalink to this headline">¶</a></h2>
<section id="solvent-stripping">
<h3>Solvent stripping<a class="headerlink" href="#solvent-stripping" title="Permalink to this headline">¶</a></h3>
<p>When we are focusing on residue-residue interactions in a polypeptide chain, solvent coordinates and velocities are not needed. It is possible to save disc space by running the follwoing scripts and disregarding the solvent degrees of freedom:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solvent spripping from the coordinates trajetory</span>
curp conv-trj -crd <span class="se">\</span>
    -p system.prmtop   -pf amber <span class="se">\</span>
    -i nev.crd.nc      -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -o stripped.crd.nc -of netcdf --orange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    mask -m mask.pdb

<span class="c1"># Solvent stripping from the velocities trajectory</span>
curp conv-trj -vel <span class="se">\</span>
    -p system.prmtop   -pf amber <span class="se">\</span>
    -i nev.vel.nc      -if netcdf  --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -o stripped.vel.nc -of netcdf  --orange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    mask -m mask.pdb
</pre></div>
</div>
<p>Suppose that the time step of the NVE simulation was 2 fs.
In the first (second) example above, the <cite>mask</cite> subcommand removes the solvent degrees of freedom from the coordinates (velocities) trajectory file, <cite>nev.crd.nc</cite> (<cite>nev.vel.nc</cite>), in which coordinates are saved every 10 fs = 5 frames (2 fs = 1 frame), and a solvent-stripped trajectory is stored in <cite>stripped.crd.nc</cite> (<cite>stripped.nev.nc</cite>). The filename of the parameter/topology file is specified after the <cite>-p</cite> option.</p>
<dl class="simple">
<dt><strong>mask</strong></dt><dd><p>This subcommand extracts selected atoms, which are recorded in the PDB file specified after the <cite>-m</cite> option. Make sure that the PDB file contains only the selected atoms, and each atom id coincides with the sequential number of the corresponding atom in the trajectory file. The other atoms will be excluded from the system.</p>
</dd>
</dl>
<p><cite>conv-trj</cite> command options</p>
<dl class="simple">
<dt><cite>-crd</cite></dt><dd><p>Setting coordinates trajectory files, whose type is assumed to be the coordinate type by default.
Note that this option is mutually exclusive with the <cite>-vel</cite> option.</p>
</dd>
<dt><cite>-vel</cite></dt><dd><p>Setting velocities trajectories files.
Note that this option is mutually exclusive with the <cite>-crd</cite> option.</p>
</dd>
<dt><cite>-p</cite></dt><dd><p>Specifies the parameter and topology file.</p>
</dd>
<dt><cite>-pf</cite></dt><dd><p>Specifies the format of the parameter and topology file.</p>
</dd>
<dt><cite>-i</cite></dt><dd><p>This option specifies the input trajectory file. By repeating this option,
multiple trajectory files are read in the order you provided.</p>
</dd>
<dt><cite>-if</cite></dt><dd><p>Specifies the format of the input trajectory file.</p>
</dd>
<dt><cite>--irange</cite></dt><dd><p>Specifies &lt;first_frame&gt;, &lt;last_frame&gt; and &lt;frame_interval&gt; for the input trajectory file.
<cite>-1</cite> for &lt;last_frame&gt; represents the last frame of the trajectory.
For example, if “1 -1 5” is provided, the conv-trj command reads
1st, 6th, 11th, … , up to the last frames out from the trajectory.</p>
</dd>
<dt><cite>-o</cite></dt><dd><p>Specifies the trajectory file for output. You are not allowed to
specify this option multiple times.</p>
</dd>
<dt><cite>-of</cite></dt><dd><p>Specifies the format of the output trajectory file.</p>
</dd>
<dt><cite>--orange</cite></dt><dd><p>Specifies &lt;first_frame&gt;, &lt;last_frame&gt; and &lt;frame_interval&gt; for the output trajectory file.
<cite>-1</cite> for &lt;last_frame&gt; represents the last frame of the trajectory.</p>
</dd>
</dl>
<p>Note that the parameter and topology file is needed to be modified
according to the solvent splitting for the subsequent MD simulations of the
new system.</p>
</section>
<section id="adjusting-the-time-points-for-the-coordinates-and-velocities-trajectory">
<h3>Adjusting the time points for the coordinates and velocities trajectory<a class="headerlink" href="#adjusting-the-time-points-for-the-coordinates-and-velocities-trajectory" title="Permalink to this headline">¶</a></h3>
<p>In the Amber restart and trajectory files, the time frames of atomic velocities are shifted by <span class="math notranslate nohighlight">\(-\Delta t/2\)</span> from those of atomic coordinates.
In the CURP program, however, the time points of the atomic coordinates must coincide with those of the atomic velocities.
Therefore, the atomic velocities in the Amber trajectory file must be
modified before the energy flow calculations. As explained below,
the <cite>conv-trj</cite> program of the CURP package estimates the atomic velocities at
the time point of <span class="math notranslate nohighlight">\(t\)</span> from those at the time points of
<span class="math notranslate nohighlight">\(t - \Delta t/2\)</span>, and <span class="math notranslate nohighlight">\(t + \Delta t/2\)</span>. Accordingly, the
velocity frames should be recorded every step to the trajectory file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Suppose that you started your MD simulation from time <span class="math notranslate nohighlight">\(t_0\)</span>. Time points of the Amber coordinate and the velocity frames are, then, (<span class="math notranslate nohighlight">\(t_0 + \Delta t, t_0 + 2\Delta t, t_0 + 3\Delta t, \cdots\)</span>), (<span class="math notranslate nohighlight">\(t_0 + \Delta t/2, t_0 + 3\Delta t/2, t_0 + 5\Delta t/2, \cdots\)</span>), respectively. In addition, the restart file contains the coordinate and the velocity frames at the time points of <span class="math notranslate nohighlight">\(t_0\)</span> and <span class="math notranslate nohighlight">\(t_0 - \Delta t/2\)</span>, respectively.</p>
</div>
<p>To modify the time points of the Amber velocities trajectory, the following
script is available:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># adjust the velocity time</span>
curp conv-trj -vel <span class="se">\</span>
    -p stripped.prmtop -pf amber <span class="se">\</span>
    -i stripped.vel.nc -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -o adjusted.vel.nc -of netcdf --orange <span class="m">5</span> -1 <span class="m">5</span> <span class="se">\</span>
    adjust-vel
</pre></div>
</div>
<p>Suppose the the NVE simulation was performed with the time step of 2 fs.
In the above example, the 1st, 2nd, … , up to the last frames are read from
the <cite>stripped.vel.nc</cite> file obtained in the <a class="reference internal" href="#solvent-stripping">Solvent stripping</a> section.
For each of the frame-pairs, (4th, 5th), (9th, 10th), <span class="math notranslate nohighlight">\(\cdots\)</span> , a new frame is generated at the midtime point of the frame-pair. Consequently, the time points of the the original 5th, 10th, <span class="math notranslate nohighlight">\(\cdots\)</span>, frames are shifted by <span class="math notranslate nohighlight">\(- \Delta t/2\)</span> altogether and output to the <cite>adjusted.vel.nc</cite> file. Note that this process is needed for the velocities trajectory obtained by the leap frog algorithm, while not needed for that obtained by the velocity Verlet algorithm.</p>
<dl class="simple">
<dt><strong>adjust-vel</strong></dt><dd><p>This subcommand shifts the time points of the velocities trajectories as described above.</p>
</dd>
</dl>
<p>In this tutorial, we provided the sample trajectories in which the
time points of the coordinates and velocities trajectories were adjusted.</p>
</section>
<section id="avoiding-missing-frame-problem-while-concatenating-multiple-trajectory-files">
<h3>Avoiding missing frame problem while concatenating multiple trajectory files<a class="headerlink" href="#avoiding-missing-frame-problem-while-concatenating-multiple-trajectory-files" title="Permalink to this headline">¶</a></h3>
<p>A special care is needed when you use the leap frog integrator, which is usually employed in the AMBER program, and split your trajectory into multipile files. Suppose that the time period of the <cite>i</cite>-th trajectory segment is <span class="math notranslate nohighlight">\([T_{i-1} + \Delta t, T_{i}]\)</span>, and the atomic coordinates and the velocities in this segment are recorded at the time points of <span class="math notranslate nohighlight">\((T_{i-1} + \Delta t, T_{i-1} + 2\Delta t, \cdots ,T_{i} - \Delta t, T_{i})\)</span> and <span class="math notranslate nohighlight">\((T_{i-1} + \Delta t/2, T_{i-1} + 3\Delta t/2, \cdots, T_{i} - 3\Delta t/2, T_{i} - \Delta t/2)\)</span>, respectively. If you need to consider the velocities at <span class="math notranslate nohighlight">\(T_{i}\)</span> for the further calculations of energy flow, you need the velocity trajectory files of both <cite>i</cite>-th and <cite>(i+1)</cite>-st segments, because the velocities at <span class="math notranslate nohighlight">\(T_{i}\)</span> are estimated from those at <span class="math notranslate nohighlight">\(T_{i} - \Delta t/2\)</span> and <span class="math notranslate nohighlight">\(T_{i} + \Delta t/2\)</span>. Note that the velocity trajectory file of the <cite>i</cite>-th segment can be replaced with the restart file generated at the end of the <cite>i</cite>-th segment.</p>
<dl class="simple">
<dt><strong>Example</strong></dt><dd><p>When you perform a MD simulation for 10 ps with the time step of <span class="math notranslate nohighlight">\(\Delta t\)</span> = 2 fs, and save the atomic coordinates every 10 fs, the time points of the atomic coordinates are 10 fs, 20 fs, <span class="math notranslate nohighlight">\(\cdots\)</span>, 9990 fs, and 10000 fs. On the other hand, you need to save the velocities every step because you need to adjust the time points of the velocities to those of the atomic coordinates. Suppose that you divide the velocities trajectory into halves, and save the first (second) half to the trajectory file named <cite>nve1.vel.nc</cite> (<cite>nve2.vel.nc</cite>). Then the time points of the velocities in <cite>nve1.vel.nc</cite> (<cite>nve2.vel.nc</cite>) are 1 fs, 3 fs, <span class="math notranslate nohighlight">\(\cdots\)</span>, 4999 fs (5001 fs, 5003 fs, <span class="math notranslate nohighlight">\(\cdots\)</span>, 9999 fs).</p>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 1: adjust velocities for the 1st half of the velocity trajectory</span>
curp conv-trj -vel <span class="se">\</span>
    -p system.prmtop -pf amber <span class="se">\</span>
    -i nve1.vel.nc -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -o stripped1.vel.nc -of netcdf --orange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    mask -m mask.pdb

 curp conv-trj -vel <span class="se">\</span>
     -p strip.prmtop -pf amber <span class="se">\</span>
     -i stripped1.vel.nc -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
     -o adjusted1.vel.nc -of netcdf --orange <span class="m">5</span> -1 <span class="m">5</span> <span class="se">\</span>
     adjust-vel
</pre></div>
</div>
<p>Example 1 shows how to adjust the time points of the velocities to those of the atomic coordinates for the first half of the trajectory after removing unnecessary part of the system. Note that <cite>strip.prmtop</cite> represents the parameter/topology file generated for <cite>mask.pdb</cite>. As a result of the adjustment, the velocities at the time points of 10f, 20fs, <span class="math notranslate nohighlight">\(\cdots\)</span>, and 4990 fs are saved to <cite>adjusted1.vel.nc</cite>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example 2: adjust velocities for the 2nd half of the velocity trajectory</span>
curp conv-trj -vel <span class="se">\</span>
    -p system.prmtop -pf amber <span class="se">\</span>
    -i nve1.rst -if restart --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -i nve2.vel.nc -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    -o stripped2.vel.nc -of netcdf --orange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
    mask -m mask.pdb

curp conv-trj -vel <span class="se">\</span>
     -p strip.prmtop -pf amber <span class="se">\</span>
     -i stripped2.vel.nc -if netcdf --irange <span class="m">1</span> -1 <span class="m">1</span> <span class="se">\</span>
     -o adjusted2.vel.nc -of netcdf --orange <span class="m">1</span> -1 <span class="m">5</span> <span class="se">\</span>
     adjust-vel
</pre></div>
</div>
<p>Similarly, example 2 shows the velocity adjustment for the 2nd half of the trajectory. Here we need to read the restart file, <cite>nve1.rst</cite> before reading the velocity trajectory <cite>nve2.vel.nc</cite>. The velocities at <cite>t</cite> = 4999 fs (<cite>t</cite> = 5001 fs) are saved in <cite>nve1.rst</cite> (at the 1st frame of <cite>nve2.vel.nc</cite>), and the velocities at <cite>t</cite> = 5000 fs are estimated from those at 4999 and 5001 fs. If the velocities at <cite>t</cite> = 5000 fs are not necessary for the final output file, you do not need to read the restart file in this example. Note that the final velocity file is generated with <cite>“–orange 1 -1 5”</cite> so that the first frame at <cite>t</cite> = 5000 fs is included in the output file named <cite>adjusted2.vel.nc</cite> and, thus, the velocities at 5000 fs, 5010 fs, <span class="math notranslate nohighlight">\(\cdots\)</span>, and 9990 fs are save in the output file.</p>
</section>
</section>
<section id="calculating-interresidue-heat-current">
<h2><a class="toc-backref" href="#id2"><span class="section-number">3.4.2. </span>Calculating interresidue heat current</a><a class="headerlink" href="#calculating-interresidue-heat-current" title="Permalink to this headline">¶</a></h2>
<p>Here we explain how to calculate the heat currents with</p>
<ol class="arabic simple">
<li><p>velocities and coordinates trajectory file</p></li>
<li><p>parameter and topology file of target system</p></li>
<li><p>configuration file for the CURP calculation</p></li>
</ol>
<p>To start the calculations, please type in the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curp compute hflow.cfg &gt; hflow.log
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mpiexec -n <span class="m">2</span> curp compute hflow.cfg &gt; hflow.log
</pre></div>
</div>
<p>for parallel calculations with OpenMPI. In this case the number of cores is 2, <code class="docutils literal notranslate"><span class="pre">hflow.cfg</span></code> (see below)  is a configuration file for the heat current calculations and <code class="docutils literal notranslate"><span class="pre">hflow.log</span></code> is the log file.</p>
<p>These commands should produce the following two files:</p>
<ul class="simple">
<li><p>hflow.log</p></li>
<li><p>flux_grp.nc</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flux_grp.nc</span></code> stores the fime series of interresidue heat flux in the netcdf format.
To check the content of this file, type in the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ncdump outdata/flux_grp.nc
</pre></div>
</div>
<section id="setting-up-hflow-cfg">
<h3>Setting up <code class="docutils literal notranslate"><span class="pre">hflow.cfg</span></code><a class="headerlink" href="#setting-up-hflow-cfg" title="Permalink to this headline">¶</a></h3>
<p>Here we show an example of <code class="docutils literal notranslate"><span class="pre">hflow.cfg</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">input</span><span class="p">]</span>
<span class="nb">format</span> <span class="o">=</span> <span class="n">amber</span>
<span class="c1"># first_last_interval = 1 4 1</span>
<span class="c1"># group_file = group.ndx</span>

<span class="p">[</span><span class="n">input_amber</span><span class="p">]</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">trajectory</span>
<span class="n">topology_file</span> <span class="o">=</span> <span class="o">../</span><span class="n">pdz3</span><span class="o">/</span><span class="n">stripped</span><span class="o">.</span><span class="n">prmtop</span><span class="o">.</span><span class="n">gz</span>
<span class="n">coordinate_format</span> <span class="o">=</span> <span class="n">netcdf</span>
<span class="n">coordinate_file</span> <span class="o">=</span> <span class="o">../</span><span class="n">pdz3</span><span class="o">/</span><span class="n">strip</span><span class="o">.</span><span class="n">crd</span><span class="o">.</span><span class="n">nc</span>
<span class="n">velocity_format</span> <span class="o">=</span> <span class="n">netcdf</span>
<span class="n">velocity_file</span> <span class="o">=</span> <span class="o">../</span><span class="n">pdz3</span><span class="o">/</span><span class="n">strip</span><span class="o">.</span><span class="n">vel</span><span class="o">.</span><span class="n">nc</span>

<span class="p">[</span><span class="n">curp</span><span class="p">]</span>
<span class="n">potential</span> <span class="o">=</span> <span class="n">amber12SB</span>
<span class="n">method</span> <span class="o">=</span> <span class="n">heat</span><span class="o">-</span><span class="n">flux</span>

<span class="n">group_method</span> <span class="o">=</span> <span class="n">residue</span>
<span class="n">flux_grain</span> <span class="o">=</span> <span class="n">group</span>
<span class="c1"># target_atoms =</span>
<span class="c1"># enable_inverse_pair = no</span>
<span class="n">group_pair_file</span> <span class="o">=</span> <span class="n">gpair</span><span class="o">.</span><span class="n">ndx</span>

<span class="n">remove_trans</span> <span class="o">=</span>  <span class="n">yes</span>
<span class="n">remove_rotate</span> <span class="o">=</span> <span class="n">yes</span>

<span class="n">log_frequency</span> <span class="o">=</span> <span class="mi">2</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">outdata</span><span class="o">/</span><span class="n">flux</span><span class="o">.</span><span class="n">nc</span>
<span class="nb">format</span> <span class="o">=</span> <span class="n">netcdf</span>
<span class="n">decomp</span> <span class="o">=</span> <span class="n">no</span>

<span class="n">output_energy</span> <span class="o">=</span> <span class="n">no</span>
</pre></div>
</div>
<p>A detailed explanation is provided below:</p>
<section id="input">
<h4>[input]<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h4>
<p>The input file format.</p>
<dl class="simple">
<dt>format = amber</dt><dd><p>Read Amber formatted files.</p>
</dd>
<dt>first_last_interval = 1 4 1</dt><dd><p>For the heat current calculations, the &lt;first&gt; and &lt;last&gt; frame with the interval of &lt;intraval&gt; frames are set in this line as &lt;first&gt; &lt;last&gt; &lt;interval&gt;.</p>
</dd>
<dt>group_file = group.ndx</dt><dd><p>In this line, atom group definition file is specified. In this file, you can define an arbitrary group of atoms that is different than the standard amino acid residues.</p>
</dd>
</dl>
</section>
<section id="input-amber">
<h4>[input_amber]<a class="headerlink" href="#input-amber" title="Permalink to this headline">¶</a></h4>
<p>In this section name,
after <code class="docutils literal notranslate"><span class="pre">input_</span></code> comes the keyword specified as the format key in the <code class="docutils literal notranslate"><span class="pre">[input]</span></code> section.
The following keywords are used in the <code class="docutils literal notranslate"><span class="pre">input_amber</span></code> section.</p>
<dl class="simple">
<dt>target = trajectory | restart</dt><dd><p>Specifies whether the input file is a trajectory file or a restart file.</p>
</dd>
<dt>topology_file = &lt;prm_top_file&gt;</dt><dd><p>Set the path to the parameter and topology file.</p>
</dd>
<dt>coordinate_format = ascii | netcdf</dt><dd><p>Set the format of the coordinate trajectory file.</p>
</dd>
<dt>coordinate_file = &lt;mdcrd_file&gt;</dt><dd><p>File name of the coordinate trajectory file.</p>
</dd>
<dt>velocity_format = ascii | netcdf</dt><dd><p>Set the format of the velocity trajectory file.</p>
</dd>
<dt>velocity_file = &lt;mdvel_file&gt;</dt><dd><p>File name of the velocity trajectory file.</p>
</dd>
</dl>
</section>
<section id="curp">
<h4>[curp]<a class="headerlink" href="#curp" title="Permalink to this headline">¶</a></h4>
<p>In this section, parameters and keywords are set for the irEF calculations.</p>
<dl class="simple">
<dt>potential = amberbase | amber94 | amber96 | amber99 | amber99SB | amber03 | amber12SB</dt><dd><p>In this line, the type of the potential function is set.</p>
</dd>
<dt>method = momentum-current | energy-flux | heat-flux</dt><dd><p>This line specifies whether the calculation is for irEF or for atomic stress tensors (momentum current) or heat flux. In this example, we choose <code class="docutils literal notranslate"><span class="pre">heat-flux</span></code>.</p>
</dd>
<dt>group_method = none | united | residue | file</dt><dd><p>In this line, the unit of irEF is set.
<code class="docutils literal notranslate"><span class="pre">none</span></code>: No groups are defined.
<code class="docutils literal notranslate"><span class="pre">united</span></code>: This specifies fixed united atom groups. All of the hydrogen atoms, whether polar or apolar, belong to the united atom group represented by the heavy atom to which they attached.
<code class="docutils literal notranslate"><span class="pre">residue</span></code>: Groups are defined by residues unit.
<code class="docutils literal notranslate"><span class="pre">file</span></code>: User defined atom groups are adopted. (see <code class="docutils literal notranslate"><span class="pre">group_file</span></code> key in the input section.)
none: No groups are formed.</p>
</dd>
<dt>flux_grain = atom | group | both</dt><dd><p>Output option for the energy flow data.
<code class="docutils literal notranslate"><span class="pre">atom</span></code>: Output inter-atomic energy flow for all atom pairs. (not recommended)
<code class="docutils literal notranslate"><span class="pre">group</span></code>: Output inter-group energy flow between all pairs of groups defined by the <code class="docutils literal notranslate"><span class="pre">group_method</span></code> keyword.
<code class="docutils literal notranslate"><span class="pre">both</span></code>: Output both of the above two data (not recommended).</p>
</dd>
<dt>target_atoms = 1-33</dt><dd><p>Specifies the target segment for the calculations. In this example, atom 1 to
33 are considered and the other atoms are neglected. If not
specified, all atoms of the system are considered. Note that the CURP program
excludes atoms other than the ones specifed by this option from the calculations, even when the group option is set to any of united/residue/file.</p>
</dd>
<dt>group_pair_file = gpair.ndx</dt><dd><p>Set group pair file. This option defines the set of group pair for which
the energy flow is calculated. This can be used to focus only on
the region of interest, saving the computational time considerably.
Without this option, CURP calculates the energy flow between all pairs of groups.</p>
</dd>
<dt>remove_trans = yes | no</dt><dd><p>If yes, the translational movement of the system is removed. (the default is yes)
NOTE: Usually, we should use “yes”.</p>
</dd>
<dt>remove_rotate = yes | no</dt><dd><p>If yes, the rotational movement of the system is removed. (the default is yes)
NOTE: Usually, we should use “yes”.</p>
</dd>
<dt>log_frequency = 2</dt><dd><p>The frequencey of output information to stdout.</p>
</dd>
</dl>
</section>
<section id="output">
<h4>[output]<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h4>
<p>Setting the output format.</p>
<dl class="simple">
<dt>filename = outdata/flux.nc</dt><dd><p>Filename of the heat flow data.</p>
</dd>
<dt>format = ascii | netcdf</dt><dd><p>Format of the energy flow data. (netcdf format is highly recommended.)</p>
</dd>
<dt>decomp = no | yes</dt><dd><p>During the calculations, choose whether the energy is decomposed into different
components.</p>
</dd>
<dt>output_energy = no | yes</dt><dd><p>CURP is able to evaluate the energy using the atomic velocities and coordinates of the trajectory files. When set to “no”, this energy value is not output.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="calculating-the-time-integral-of-interresidue-heat-current">
<h2><a class="toc-backref" href="#id3"><span class="section-number">3.4.3. </span>Calculating the time-integral of interresidue heat current</a><a class="headerlink" href="#calculating-the-time-integral-of-interresidue-heat-current" title="Permalink to this headline">¶</a></h2>
<p>After heat flux calculations, <span class="math notranslate nohighlight">\(\Lambda\)</span> is calculated based on the linear response theory.
You will need the time series of <span class="math notranslate nohighlight">\(\Lambda\)</span> stored in <cite>flux_grp.nc</cite>. Type in the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curp cal-tc <span class="se">\</span>
    --frame-range <span class="m">1</span> <span class="m">10</span> <span class="m">1</span> --average-shift <span class="m">1</span> <span class="se">\</span>
    -a outdata/acf.nc <span class="se">\</span>
    -o outdata/Lambda.dat outdata/flux_grp.nc &gt; Lambda.log
</pre></div>
</div>
<dl class="simple">
<dt><cite>--frame-range &lt;first_frame&gt; &lt;last_frame&gt; &lt;frame_interval&gt;</cite></dt><dd><p>This specifies the range of the time integration of the auto-correlation function of heat currents, <span class="math notranslate nohighlight">\(\left\langle \mathbf{h}(0) \cdot \mathbf{h}(t) \right\rangle\)</span>.
The upper and lower limits of the integral are set in &lt;first_frame&gt;,
&lt;last_frame&gt;, respectively. During the integration, every &lt;frame_interval&gt;
frames are used for calculations.</p>
</dd>
<dt><cite>--average-shift &lt;ave_shift&gt;</cite></dt><dd><p>In the calculation of irEC, J(0)J(t) is integrated from &lt;first_fram&gt; to
&lt;last_frame&gt;. Then, the origin of the integration is shifted by &lt;ave_shift&gt;
and the time integration is again conducted from &lt;first_frame&gt; to &lt;last_frame&gt;.
This procedure is then repeated until the end point of the time integration
reaches the end of the trajectory.</p>
</dd>
<dt><cite>-a &lt;file_name&gt;</cite></dt><dd><p>The time-correlation function data are output to &lt;file_name&gt;.
The data format is netcdf. If this key is not specified, no data is output.</p>
</dd>
<dt><cite>-o &lt;file_name&gt;</cite></dt><dd><p><span class="math notranslate nohighlight">\(\Lambda\)</span> data is output to &lt;file_name&gt;.</p>
</dd>
</dl>
<p>You will then obtain energy conductivity data <code class="docutils literal notranslate"><span class="pre">output/Lambda.dat</span></code> and the
time-correlatioin data file, <code class="docutils literal notranslate"><span class="pre">outdata/acf.nc</span></code>.</p>
<p>NOTE: <cite>--no-axes</cite> option should not be used here.</p>
<section id="format-of-lambda-data-file">
<h3>Format of <span class="math notranslate nohighlight">\(\Lambda\)</span> data file<a class="headerlink" href="#format-of-lambda-data-file" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>In each line of the data file, <cite>Lambda.dat</cite>, a pair of residues and the corresponding value of <span class="math notranslate nohighlight">\(\Lambda_{AB}\)</span> is written as &lt;residue_A&gt; &lt;residue_B&gt; <span class="math notranslate nohighlight">\(\Lambda_{AB}\)</span>. The unit of <span class="math notranslate nohighlight">\(\Lambda_{AB}\)</span> is measured in <span class="math notranslate nohighlight">\((\AA \rm{\cdot kcal/mol)^2/fs}\)</span>.</p>
</div></blockquote>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">3.4. Heat current analysis</a><ul>
<li><a class="reference internal" href="#preparing-trajectories">3.4.1. Preparing trajectories</a><ul>
<li><a class="reference internal" href="#solvent-stripping">Solvent stripping</a></li>
<li><a class="reference internal" href="#adjusting-the-time-points-for-the-coordinates-and-velocities-trajectory">Adjusting the time points for the coordinates and velocities trajectory</a></li>
<li><a class="reference internal" href="#avoiding-missing-frame-problem-while-concatenating-multiple-trajectory-files">Avoiding missing frame problem while concatenating multiple trajectory files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calculating-interresidue-heat-current">3.4.2. Calculating interresidue heat current</a><ul>
<li><a class="reference internal" href="#setting-up-hflow-cfg">Setting up <code class="docutils literal notranslate"><span class="pre">hflow.cfg</span></code></a><ul>
<li><a class="reference internal" href="#input">[input]</a></li>
<li><a class="reference internal" href="#input-amber">[input_amber]</a></li>
<li><a class="reference internal" href="#curp">[curp]</a></li>
<li><a class="reference internal" href="#output">[output]</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#calculating-the-time-integral-of-interresidue-heat-current">3.4.3. Calculating the time-integral of interresidue heat current</a><ul>
<li><a class="reference internal" href="#format-of-lambda-data-file">Format of <span class="math notranslate nohighlight">\(\Lambda\)</span> data file</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../eflow_tutorial/"
                          title="previous chapter"><span class="section-number">3.3. </span>Energy flow analysis</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../reference/"
                          title="next chapter"><span class="section-number">4. </span>Reference</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/hflow_tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../reference/" title="4. Reference"
             >next</a> |</li>
        <li class="right" >
          <a href="../eflow_tutorial/" title="3.3. Energy flow analysis"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">CURP 1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../tutorials/" ><span class="section-number">3. </span>Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3.4. </span>Heat current analysis</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2022, Yamato Labaratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>